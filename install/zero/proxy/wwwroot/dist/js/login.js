require(["jquery","common","template","fastclick","Toast","Timer","apiMain"],function(t,e,o,n,s,i,r){function a(){var arguments=arguments.length?arguments[0]:arguments;this.code=arguments.code?arguments.code:"#code",this.tell=arguments.tell?arguments.tell:"#tell",this.btnCode=arguments.btnCode?arguments.btnCode:".btn-code",this.btnStart=arguments.btnStart?arguments.btnStart:".btn-start",this.btnLogin=arguments.btnLogin?arguments.btnLogin:".btn-login",this.constructor()}a.prototype.constructor=function(){return this.exeAjaxRequestCode(),this.exeAjaxRequestLogin(),this},a.prototype.startTimer=function(){var e=this,o=10;return t(document).on("click",this.btnStart,function(){window.timer=setInterval(function(){if(0===o)return void clearInterval(window.timer);t(e.btnStart).text("0"+--o)},1e3)}),this},a.prototype.checkTellNotEmpty=function(){var e=!1,o=new s,n=/^1\d{10}$/,i=t(this.tell).val().trim();return i?n.test(i)?e=!0:o.show(o.WARNING,"输入有误"):o.show(o.INFORMATION,"非空输入"),o=null,e},a.prototype.checkCodeNotEmpty=function(){var e=!1,o=new s,n=/^\d{4}$/,i=t(this.code).val().trim();return i?n.test(i)?e=!0:o.show(o.WARNING,"输入有误"):o.show(o.INFORMATION,"非空输入"),o=null,e},a.prototype.saveToSessionStorage=function(t){var e=t.data||{};return sessionStorage.setItem("NickName",e.NickName),sessionStorage.setItem("PhoneNumber",e.PhoneNumber),sessionStorage.setItem("AccessToken","Bearer "+e.AccessToken),setTimeout(function(){var t=sessionStorage.getItem("html")||"/app/index.html?v=a093ff61e2";window.location.replace(t)},1e3),this},a.prototype.ajaxRequestCode=function(){return e.$ajax({url:r.getUrl("sendSms"),data:r.getParams({Value:t(this.tell).val().trim()}),success:function(t){t=t||{};var e=new s;t.success?e.show(e.SUCCESS,"发送成功"):e.show(e.ERROR,"发送失败"),e=null}}),this},a.prototype.exeAjaxRequestCode=function(){var e=this;return t(document).on("click",this.btnCode,function(){e.checkTellNotEmpty()&&(t(this).hasClass("disabled")||(e.ajaxRequestCode(),new i({seconds:60,selector:e.btnCode,callback:function(){console.log("倒计时完成")}})))}),this},a.prototype.ajaxRequestLogin=function(){var o=this;return e.$ajax({url:r.getUrl("smsLogin"),data:r.getParams({MobilePhone:t(this.tell).val().trim(),SMSVerificationCode:t(this.code).val().trim(),TraceMark:"活动跟踪码",Channel:"手机登录"}),success:function(t){t=t||{};var e=new s;t.success?(e.show(e.SUCCESS,"登录成功"),o.saveToSessionStorage(t)):e.show(e.ERROR,"登录失败"),e=null}}),this},a.prototype.exeAjaxRequestLogin=function(){var e=this;return t(document).on("click",this.btnLogin,function(){e.checkTellNotEmpty()&&e.checkCodeNotEmpty()&&e.ajaxRequestLogin()}),this},new a});